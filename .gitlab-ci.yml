image: node:latest

services:
  - docker:dind

variables:
  DOCKER_DRIVER: overlay2

build:
  script:
    - cp src/bot.json.sample src/bot.json
    - cp src/configuration.json.sample src/configuration.json
    - npm i
    - npm run build
    - apt-get update -qq && apt-get install -y -qq lftp
    - lftp ftp://${FTP_USERNAME}:${FTP_PASSWORD}@${FTP_HOST}:${FTP_PORT} -e "set ftp:ssl-allow no; set ssl:verify-certificate false; mirror -R build ./html/bliss/master --ignore-time --parallel=10 --exclude-glob .git* --exclude .git/; quit"
  only:
    - master
    - production